<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Admin ‚Ä¢ Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --bg:#020617;
  --panel:#020617;
  --border:#1e293b;
  --muted:#94a3b8;
  --accent:#22c55e;
  --danger:#dc2626;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  color:#fff;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
}

/* ===== LAYOUT ===== */
.layout{
  display:flex;
  min-height:100vh;
}

/* ===== SIDEBAR ===== */
.sidebar{
  width:240px;
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:20px 16px;
  display:flex;
  flex-direction:column;
  gap:20px;
}

.logo{
  font-weight:700;
  text-align:center;
  padding-bottom:12px;
  border-bottom:1px solid var(--border);
}

.menu{
  display:flex;
  flex-direction:column;
  gap:6px;
}

.menu a{
  text-decoration:none;
  color:#fff;
  padding:10px 12px;
  border-radius:8px;
  font-size:14px;
  display:flex;
  align-items:center;
  gap:10px;
}

.menu a:hover{background:rgba(255,255,255,.05)}
.menu a.active{background:rgba(34,197,94,.15);color:var(--accent)}

.sidebar-footer{margin-top:auto}

.logout-btn{
  width:100%;
  background:transparent;
  border:1px solid var(--border);
  color:#fff;
  padding:10px;
  border-radius:8px;
  cursor:pointer;
}

/* ===== CONTENT ===== */
.content{
  flex:1;
  padding:20px;
  max-width:1200px;
  margin:auto;
}

/* ===== HEADER MOBILE ===== */
.header{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:20px;
}

.menu-toggle{
  display:none;
  font-size:22px;
  background:none;
  border:none;
  color:white;
  cursor:pointer;
}

/* ===== STATS ===== */
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
  margin-bottom:24px;
}

.stat{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:18px;
}

.stat span{
  font-size:13px;
  color:var(--muted);
}

.stat strong{
  display:block;
  margin-top:6px;
  font-size:28px;
}

/* ===== TABLE ===== */
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:16px;
}

.table-wrap{
  overflow-x:auto;
}

table{
  width:100%;
  border-collapse:collapse;
  min-width:850px;
}

th,td{
  padding:10px;
  border-bottom:1px solid var(--border);
  font-size:13px;
  text-align:left;
}

th{color:var(--muted);font-weight:500}
td.numeros{font-size:12px;color:#e5e7eb}

/* ===== OVERLAY ===== */
.overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  z-index:1000;
}

/* ===== MOBILE ===== */
@media(max-width:900px){
  .menu-toggle{display:block}

  .sidebar{
    position:fixed;
    top:0;
    left:-260px;
    height:100vh;
    z-index:1001;
    transition:left .3s ease;
  }

  .sidebar.open{left:0}
  .overlay.show{display:block}

  .content{
    padding:16px;
    max-width:100%;
  }
}
</style>
</head>

<body>

<div class="overlay" id="overlay"></div>

<div class="layout">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="logo">üéõ Admin Panel</div>

  <nav class="menu">
    <a class="active">üìä Dashboard</a>
    <a href="settings.html">‚öôÔ∏è Configuraci√≥n</a>
    <a href="../index.html" target="_blank">üåê Ver sitio</a>
  </nav>

  <div class="sidebar-footer">
    <button id="logout" class="logout-btn">Cerrar sesi√≥n</button>
  </div>
</aside>

<!-- CONTENT -->
<main class="content">

  <div class="header">
    <button class="menu-toggle" id="menuToggle">‚ò∞</button>
    <h1 style="margin:0">Dashboard</h1>
  </div>

  <section class="stats">
    <div class="stat">
      <span>Total compras</span>
      <strong id="totalCompras">0</strong>
    </div>
    <div class="stat">
      <span>Total tickets</span>
      <strong id="totalTickets">0</strong>
    </div>
    <div class="stat">
      <span>Total vendido (Bs)</span>
      <strong id="totalBolivares">0 Bs</strong>
    </div>
  </section>

  <section class="card">



<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px">
  <h2 style="margin:0">Compras registradas</h2>

  <button id="resetCompras"
    style="
      background:#7c2d12;
      border:none;
      color:white;
      padding:8px 14px;
      border-radius:8px;
      cursor:pointer;
      font-size:13px;
    ">
    üóë Reiniciar compras
  </button>
</div>


    
    <div class="table-wrap">
      <table id="tablaCompras">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Tel√©fono</th>
            <th>Correo</th>
            <th>C√©dula</th>
            <th>Tickets</th>
            <th>Referencia</th>
            <th>N√∫meros</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

</main>
</div>


<script type="module">
import { auth } from "../firebase.js";
import { onAuthStateChanged, signOut }
  from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

onAuthStateChanged(auth, user => {
  if (!user) {
    window.location.href = "login.html";
  }
});

document.getElementById("logout")?.addEventListener("click", async () => {
  await signOut(auth);
  window.location.href = "login.html";
});
</script>





  
<script type="module">
import { db } from "../firebase.js";
import {
  collection,
  getDocs,
  query,
  orderBy,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const tbody = document.querySelector("#tablaCompras tbody");
const totalComprasEl = document.getElementById("totalCompras");
const totalTicketsEl = document.getElementById("totalTickets");
const totalBolivaresEl = document.getElementById("totalBolivares");
const resetBtn = document.getElementById("resetCompras");

const PRECIO_TICKET = 219;

async function cargarCompras() {
  let compras = 0, tickets = 0, bolivares = 0;
  tbody.innerHTML = "";

  const q = query(collection(db, "compras"), orderBy("fecha", "desc"));
  const snap = await getDocs(q);

  snap.forEach(d => {
    const data = d.data();

    compras++;
    tickets += data.tickets || 0;
    bolivares += (data.tickets || 0) * PRECIO_TICKET;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${data.nombre || "-"}</td>
      <td>${data.telefono || "-"}</td>
      <td>${data.correo || "-"}</td>
      <td>${data.cedula || "-"}</td>
      <td>${data.tickets || 0}</td>
      <td>${data.referencia || "-"}</td>
      <td class="numeros">${(data.numeros || []).join(", ")}</td>
      <td>${data.fecha?.toDate().toLocaleString() || "-"}</td>
    `;
    tbody.appendChild(tr);
  });

  totalComprasEl.textContent = compras;
  totalTicketsEl.textContent = tickets;
  totalBolivaresEl.textContent = bolivares + " Bs";
}

cargarCompras();

/* ===== RESET ===== */
resetBtn?.addEventListener("click", async () => {
  const ok = confirm("‚ö†Ô∏è ¬øSeguro que deseas borrar TODAS las compras?");
  if (!ok) return;

  const snap = await getDocs(collection(db, "compras"));
  for (const d of snap.docs) {
    await deleteDoc(doc(db, "compras", d.id));
  }

  alert("‚úÖ Compras reiniciadas");
  cargarCompras();
});
</script>

<script>
const menuToggle = document.getElementById("menuToggle");
const sidebar = document.querySelector(".sidebar");
const overlay = document.getElementById("overlay");

menuToggle?.addEventListener("click", () => {
  sidebar.classList.add("open");
  overlay.classList.add("show");
});

overlay?.addEventListener("click", () => {
  sidebar.classList.remove("open");
  overlay.classList.remove("show");
});
</script>

</body>
</html>







